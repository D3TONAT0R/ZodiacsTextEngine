<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>ZodiacsTextEngine | Custom Functions</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <main>
        <h1>Custom Functions</h1>
        <p>
            Custom functions in the ZodiacsTextEngine allow you to extend the functionality
            of the engine by writing code which can be executed using the <a href="effects.html#func">+FUNC Effect</a>
            or as part of a <a href="rich-text.html">Rich Text Tag</a>.
        </p>
        <p>
            There are two main ways to define custom functions:
        </p>
        <ul>
            <li><a href="#writing-function-files">Writing Function Files</a></li>
            <li><a href="#registering-functions-via-contentloader">Registering Functions via ContentLoader</a></li>
        </ul>
        <h2 id="writing-function-files">Writing Function Files</h2>
        <p>
            Function files are separate text files that define custom functions. These files are loaded
            alongside the room files and are compiled into executable code when the game starts.
        </p>
        <p>
            Function files use the <code>.funcs</code> extension and can contain an arbitrary number of functions.
        </p>
        <p>
            Functions can be triggered by writing <code>+FUNC <i>function_name</i></code> or
            <code>+<i>FUNCTION_NAME</i></code> followed by any required arguments.
        </p>
        <h3>Function File Structure</h3>
        <code-block>
            <span>//Define a function named 'math_add'</span>
            <span># math_add</span>
            <span>int x = int.Parse(args[0]);</span>
            <span>int y = int.Parse(args[1]);</span>
            <span>int result = x + y;</span>
            <span>//Print the result</span>
            <span>return $"The sum of {x} and {y} is {result}";</span>
            <span></span>
            <span>//Define an async function named 'request_login_data'</span>
            <span># request_login_data async</span>
            <span>window.Text("Enter Username:");</span>
            <span>string username = await window.ReadInput();</span>
            <span>vars.SetString("username", username);</span>
            <span>window.Text("Enter Password:");</span>
            <span>string password = await window.ReadInput();</span>
            <span>vars.SetString("password", password);</span>
            <span>window.Text($"User {username} identified.");</span>
            <span>return null; //Don't output anything else</span>
        </code-block>
        <p>Example usage is as follows:</p>
        <code-block>
            <span>+FUNC math_add 1 2</span>
            <span>// OR</span>
            <span>+MATH_ADD 3 4</span>
            <span></span>
            <span>+FUNC request_login_data</span>
        </code-block>
        <output-window>
            The sum of 1 and 2 is 3<br>
            The sum of 3 and 4 is 7<br>
            Enter Username:<br>
            <prompt>admin</prompt>
            Enter Password:<br>
            <prompt>123</prompt>
            User admin identified.<br>
            <prompt>_</prompt>
        </output-window>
        <p>
            The body of a single function must have a return statement that returns text
            to be displayed in the output window. If null is returned, no text will be displayed.<br>
            In the case of an async function, the returned value must be <code>Task&lt;string&gt;</code> or <code>null</code>.
        </p>
        <p>When writing function files, you have limited access to certain assemblies:</p>
        <ul>
            <span><code>netstandard.dll</code></span>
            <span><code>System.Runtime.dll</code></span>
            <span><code>ZodiacsTextEngine</code></span>
        </ul>
        <p>The following usings are pre-defined in function files:</p>
        <ul>
            <span><code>using System;</code></span>
            <span><code>using System.Linq;</code></span>
            <span><code>using System.Collections.Generic;</code></span>
            <span><code>using ZodiacsTextEngine;</code></span>
            <span><code>using ZodiacsTextEngine.Effects;</code></span>
        </ul>
        <p>To simplify writing functions, certain accessors are provided:</p>
        <ul>
            <span><code>window</code> - Shorthand access to the text interface (<code>ZodiacsTextEngine.TextEngine.Interface</code>).</span>
            <span><code>vars</code> - Shorthand access to the variable storage (<code>ZodiacsTextEngine.GameSession.Current.variables</code>).</span>
            <span><code>gameData</code> - Shorthand access to the game data (<code>ZodiacsTextEngine.TextEngine.GameData</code>).</span>
        </ul>
        <h2 id="registering-functions-via-contentloader">Registering Functions via ContentLoader</h2>
        <code-block>
            <span>protected override IEnumerable<(string, Functions.FunctionDelegate)> LoadFunctions()</span>
            <span>{</span>
            <span>&#9;yield return Functions.CreateFunction("math_add", parameters =></span>
            <span>&#9;&#9;int x = int.Parse(parameters[0]);</span>
            <span>&#9;&#9;int y = int.Parse(parameters[1]);</span>
            <span>&#9;&#9;int result = x + y;</span>
            <span>&#9;&#9;TextEngine.Interface.Write($"The sum of {x} and {y} is {result}");</span>
            <span>&#9;&#9;return null;</span>
            <span>&#9;));</span>
            <span>}</span>
        </code-block>
    </main>
    <footer>
        <p>ZodiacsTextEngine Documentation | 2025 | By <a href="https://github.com/D3TONAT0R">D3TONAT0R</a></p>
    </footer>
    <script src="navigation.js"></script>
</body>

</html>