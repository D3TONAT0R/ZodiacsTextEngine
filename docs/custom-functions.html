<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>ZodiacsTextEngine | Custom Functions</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <main>
        <h1>Custom Functions</h1>
        <p>
            Custom functions in the ZodiacsTextEngine allow you to extend the functionality
            of the engine by writing code which can be executed using the <a href="effects.html#func">+FUNC Effect</a>
            or as part of a <a href="rich-text.html">Rich Text Tag</a>.
        </p>
        <div class="remark">
            Prior knowledge of C# and a moderate understanding of the ZodiacsTextEngine's codebase is recommended
            to be able to write functions.
        </div>
        <p>
            There are two main ways to define custom functions:
        </p>
        <ul>
            <li><a href="#writing-function-files">Writing Function Files</a></li>
            <li><a href="#registering-functions-via-contentloader">Registering Functions via ContentLoader</a></li>
        </ul>
        <h2 id="writing-function-files">Writing Function Files</h2>
        <p>
            Function files are separate text files that define custom functions. These files are loaded
            alongside the room files and are compiled into executable code when the game starts.
        </p>
        <p>
            Function files use the <code>.funcs</code> extension and can contain an arbitrary number of functions.
        </p>
        <p>
            Functions can be triggered by writing <code>+FUNC <i>function_name</i></code> or
            <code>+<i>FUNCTION_NAME</i></code> followed by any required arguments.
        </p>
        <h3 id="function-file-structure">Function File Structure</h3>
        <code-block>
            <span>//Define a function named 'math_add'</span>
            <span># math_add</span>
            <span>int x = args.GetInt(0);</span>
            <span>int y = args.GetInt(1);</span>
            <span>int result = x + y;</span>
            <span>//Print the result</span>
            <span>return $"The sum of {x} and {y} is {result}";</span>
            <span></span>
            <span>//Define an async function named 'request_login_data'</span>
            <span># request_login_data async</span>
            <span>window.Text("Enter Username:");</span>
            <span>string username = await window.ReadInput();</span>
            <span>vars.SetString("username", username);</span>
            <span>window.Text("Enter Password:");</span>
            <span>string password = await window.ReadInput();</span>
            <span>vars.SetString("password", password);</span>
            <span>window.Text($"User {username} identified.");</span>
            <span>return null; //Don't output anything else</span>
        </code-block>
        <p>Example usage is as follows:</p>
        <code-block>
            <span>+FUNC math_add 1 2</span>
            <span>// OR</span>
            <span>+MATH_ADD 3 4</span>
            <span></span>
            <span>+FUNC request_login_data</span>
        </code-block>
        <output-window>
            The sum of 1 and 2 is 3<br>
            The sum of 3 and 4 is 7<br>
            Enter Username:<br>
            <prompt>admin</prompt>
            Enter Password:<br>
            <prompt>123</prompt>
            User admin identified.<br>
            <prompt>_</prompt>
        </output-window>
        <p>
            The body of a single function must have a return statement that returns text
            to be displayed in the output window. If null is returned, no text will be displayed.<br>
            In the case of an async function, the returned value must be <code>Task&lt;string&gt;</code> or <code>null</code>.
        </p>
        <p>When writing function files, you have limited access to certain assemblies:</p>
        <ul>
            <li><code>netstandard.dll</code></li>
            <li><code>System.Runtime.dll</code></li>
            <li><code>ZodiacsTextEngine</code></li>
        </ul>
        <p>The following usings are pre-defined in function files:</p>
        <ul>
            <li><code>using System;</code></li>
            <li><code>using System.Linq;</code></li>
            <li><code>using System.Collections.Generic;</code></li>
            <li><code>using ZodiacsTextEngine;</code></li>
            <li><code>using ZodiacsTextEngine.Effects;</code></li>
        </ul>
        <p>To get the arguments from the function call, you can use the <code>args</code> parameter,
            which is of type <code>FunctionArgs</code>:</p>
        <ul>
            <li><code>args[<i>x</i>]</code> - Gets the argument at index <i>x</i>. If out of range, an empty string is returned.</li>
            <li><code>args.Length</code> - Gets the number of arguments.</li>
            <li><code>args.raw</code> - Gets the raw argument input as one string.</li>
            <li><code>args.GetInt(<i>x</i>)</code> - Gets the argument at index <i>x</i> as an integer.
                Raises an exception if unsuccessful.
            </li>
            <li><code>args.TryGetInt(<i>x</i>, out int result)</code> - Tries to get the argument at index <i>x</i> as an integer.
                Returns true if successful, false otherwise.
            </li>
            <li>The same <code>Get...</code> and <code>TryGet...</code> methods are available floats and strings as well.</li>
        </ul>
        <p>To simplify writing functions, certain helper variables and methods are provided:</p>
        <ul>
            <li><code>window</code> - Shorthand access to the text interface (<code>ZodiacsTextEngine.TextEngine.Interface</code>).</li>
            <li><code>vars</code> - Shorthand access to the variable storage (<code>ZodiacsTextEngine.GameSession.Current.variables</code>).</li>
            <li><code>story</code> - Shorthand access to the story content (<code>ZodiacsTextEngine.TextEngine.Story</code>).</li>
            <li><code>room</code> - Shorthand access to the current room (<code>ZodiacsTextEngine.GameSession.Current.currentRoom</code>).</li>
            <li><code>GoTo(<i>name/room</i>)</code> - Shorthand access to go to another room (<code>ZodiacsTextEngine.GameSession.Current.GoToRoom(...)</code>)
                , must be called using <code>await GoTo(...);</code>.</li>
            <p>These are only available within function files, not when registering functions via the ContentLoader.</p>
        </ul>
        <h2 id="registering-functions-via-contentloader">Registering Functions via ContentLoader</h2>
        <code-block>
            <span>protected override IEnumerable<(string, Functions.FunctionDelegate)> LoadFunctions()</span>
            <span>{</span>
            <span>&#9;yield return Functions.CreateFunction("math_add", args =></span>
            <span>&#9;&#9;int x = args.GetInt(0);</span>
            <span>&#9;&#9;int y = args.GetInt(1);</span>
            <span>&#9;&#9;int result = x + y;</span>
            <span>&#9;&#9;TextEngine.Interface.Write($"The sum of {x} and {y} is {result}");</span>
            <span>&#9;&#9;return null;</span>
            <span>&#9;));</span>
            <span>}</span>
        </code-block>
        <footer>
            <p>ZodiacsTextEngine Documentation | 2025 | By <a href="https://github.com/D3TONAT0R">D3TONAT0R</a></p>
        </footer>
    </main>
    <script src="navigation.js"></script>
</body>

</html>